#### {{ ansible_managed }} ####
# Local changes *may* be deleted

[sssd]
  config_file_version = 2
  services = nss, pam
  domains = {% for item in uan_ldap_config %}{{ item.domain }}{{ "," if not loop.last else "" }}{% endfor %}

[nss]
  filter_users = root, crayadm
  filter_groups = root

[pam]

{% for cfg in uan_ldap_config %}
[domain/{{ cfg.domain }}]
  ldap_search_base={{ cfg.search_base }}
  ldap_uri={% for item in cfg.servers %}{{ item }}{{ "," if not loop.last else "" }}{% endfor %}{{''}}
  id_provider = ldap
  auth_provider = ldap
  ldap_tls_reqcert = allow
  ldap_schema = rfc2307
{% if ldap_port != 389 %}
  entry_cache_timeout = 60 
  cache_credentials = true 
  case_sensitive = true 
  enumerate = false 
  ldap_use_tokengroups = false 
{% endif %}
{% if cfg.chpass_uri is defined %}
  ldap_chpass_uri={% for item in cfg.chpass_uri %}{{ item }}{{ "," if not loop.last else ""}}{% endfor %}{{''}}
{% endif %}

{% endfor %}

